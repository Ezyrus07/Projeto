/* ============================================================
   Page - Chat
   Data: 2026-02-07
   - Ajustes de safe-area + evitar overflow e gaps no mobile
   ============================================================ */

@media (max-width: 1024px){
  body[data-page="chat"]{
    padding-bottom: 0 !important;
    overflow: hidden !important;
  }

  body[data-page="chat"] .navbar-mobile,
  body[data-page="chat"] .bottom-nav,
  body[data-page="chat"] #overlay-menu{
    display: none !important;
  }

  body[data-page="chat"] .doke-bottom-spacer{
    display: none !important;
    height: 0 !important;
  }

  /* Chat nao usa <main>; zera espacamento extra global do shell */
  body[data-page="chat"].doke-no-main{
    padding-bottom: 0 !important;
  }

  body[data-page="chat"] .messenger-layout{
    width: 100% !important;
    max-width: 100% !important;
    margin-top: 0 !important;
    margin-left: 0 !important;
    /* Altura util = viewport - header shell - bottom nav real
       (evita gap entre composer e nav e evita sobreposicao) */
    height: calc(100vh - var(--doke-h) - var(--doke-btm-real)) !important;
    height: calc(100svh - var(--doke-h) - var(--doke-btm-real)) !important;
    height: calc(100dvh - var(--doke-h) - var(--doke-btm-real)) !important;
    min-height: 0 !important;
    margin-bottom: 0 !important;
    overflow: hidden !important;
  }

  /* Colunas com altura total do container (sem padding extra embaixo) */
  body[data-page="chat"] .coluna-lista,
  body[data-page="chat"] .coluna-chat{
    height: 100% !important;
    min-height: 0 !important;
    padding-bottom: 0 !important;
    box-sizing: border-box !important;
    overflow: hidden !important;
  }

  body[data-page="chat"] #box-conversa-real{
    display: flex !important;
    flex-direction: column !important;
    height: 100% !important;
    min-height: 0 !important;
    overflow: hidden !important;
  }

  body[data-page="chat"] .mensagens-body{
    flex: 1 1 auto !important;
    min-height: 0 !important;
    height: auto !important;
  }

  body[data-page="chat"] #area-input-texto,
  body[data-page="chat"] #uiGravando{
    min-width: 0 !important;
  }

  body[data-page="chat"] .input-msg{
    min-width: 0 !important;
  }

  body[data-page="chat"] .chat-footer,
  body[data-page="chat"] .composer,
  body[data-page="chat"] .message-input-area{
    margin-bottom: 0 !important;
  }

  /* Composer mais compacto/colado ao nav */
  body[data-page="chat"] .chat-footer{
    padding: 7px 10px !important;
    min-height: 54px !important;
    border-top: 1px solid rgba(2,6,23,.06) !important;
  }

  body[data-page="chat"] #area-input-texto{
    gap: 8px !important;
  }

  body[data-page="chat"] .btn-attach,
  body[data-page="chat"] .btn-enviar{
    width: 38px !important;
    height: 38px !important;
  }

  body[data-page="chat"] .input-msg{
    padding: 10px 14px !important;
    border-radius: 22px !important;
  }

  body[data-page="chat"] .mensagens-body{
    padding-bottom: 2px !important;
  }

  body[data-page="chat"] .doke-bottom-nav{
    padding-top: 3px !important;
  }

  body[data-page="chat"] img,
  body[data-page="chat"] video,
  body[data-page="chat"] audio{
    max-width: 100% !important;
  }
}

body[data-page="chat"] .doke-bottom-spacer{
  display: none !important;
  height: 0 !important;
}

/* Garante barra de envio colada no nav em qualquer largura */
body[data-page="chat"] .chat-footer{
  margin-top: auto !important;
  margin-bottom: 0 !important;
  flex-shrink: 0 !important;
  position: relative;
  z-index: 2;
}

/* Desktop/tablet grande: evita estouro horizontal em blocos internos */
body[data-page="chat"] .messenger-layout,
body[data-page="chat"] .coluna-lista,
body[data-page="chat"] .coluna-chat{
  min-width: 0 !important;
}

/* Icones de acao sempre centralizados */
body[data-page="chat"] .btn-attach,
body[data-page="chat"] .btn-enviar,
body[data-page="chat"] .chat-menu-btn,
body[data-page="chat"] .agenda-nav,
body[data-page="chat"] .scroll-down,
body[data-page="chat"] .btn-voltar-mobile{
  display: grid !important;
  place-items: center !important;
  line-height: 1 !important;
  padding: 0 !important;
}

body[data-page="chat"] .btn-attach i,
body[data-page="chat"] .btn-enviar i,
body[data-page="chat"] .chat-menu-btn i,
body[data-page="chat"] .agenda-nav i,
body[data-page="chat"] .scroll-down i,
body[data-page="chat"] .btn-voltar-mobile i{
  display: block !important;
  line-height: 1 !important;
}

/* Linhas de mensagem + avatar do contato */
body[data-page="chat"] .msg-row{
  width: 100%;
  display: flex;
  margin: 2px 0;
}

body[data-page="chat"] .msg-row-me{
  justify-content: flex-end;
}

body[data-page="chat"] .msg-row-peer{
  justify-content: flex-start;
  align-items: flex-end;
  gap: 8px;
}

body[data-page="chat"] .msg-peer-avatar{
  width: 28px;
  height: 28px;
  border-radius: 50%;
  object-fit: cover;
  flex: 0 0 28px;
  border: 1px solid rgba(148, 163, 184, 0.45);
  box-shadow: 0 2px 7px rgba(2, 6, 23, 0.10);
}

body[data-page="chat"] .msg-row-bubble{
  min-width: 0;
  flex: 0 1 auto;
}

/* Evita bolha "espremida" em coluna após wrapper com avatar */
body[data-page="chat"] .msg-row .msg-bubble{
  display: block !important;
  width: auto !important;
  min-width: 116px !important;
  max-width: min(80vw, 360px) !important;
  word-break: normal !important;
  overflow-wrap: anywhere !important;
}

body[data-page="chat"] .msg-row .msg-footer{
  display: flex !important;
  align-items: center !important;
  gap: 6px !important;
  flex-wrap: nowrap !important;
  white-space: nowrap !important;
}

body[data-page="chat"] .msg-row .msg-hora{
  float: none !important;
  display: inline-flex !important;
  align-items: center !important;
  white-space: nowrap !important;
  word-break: keep-all !important;
  letter-spacing: 0 !important;
  line-height: 1 !important;
}

body[data-page="chat"] .msg-row .msg-reply-btn{
  float: none !important;
  flex: 0 0 auto !important;
}

body[data-page="chat"] .msg-row-me .msg-footer{
  justify-content: flex-end !important;
}

body[data-page="chat"] .msg-row-peer .msg-footer{
  justify-content: flex-start !important;
}

body[data-page="chat"] .msg-row .audio-bubble{
  min-width: 168px !important;
  width: 100% !important;
}

body[data-page="chat"] .msg-row .audio-wave{
  width: 100% !important;
  max-width: 160px !important;
}

/* Lista de conversas: nome/status sem quebrar layout */
body[data-page="chat"] .item-conversa .ic-info{
  min-width: 0 !important;
}

body[data-page="chat"] .item-conversa .ic-nome,
body[data-page="chat"] .item-conversa .ic-msg{
  display: block !important;
  max-width: 100% !important;
  white-space: nowrap !important;
  overflow: hidden !important;
  text-overflow: ellipsis !important;
}

body[data-page="chat"] .item-conversa .ic-nome{
  font-weight: 800 !important;
}

body[data-page="chat"] .item-conversa .ic-msg{
  font-weight: 600 !important;
}

body[data-page="chat"] .archive-btn{
  display: grid !important;
  place-items: center !important;
  line-height: 1 !important;
  padding: 0 !important;
}

body[data-page="chat"] .archive-btn i{
  display: block !important;
  line-height: 1 !important;
  font-size: 18px !important;
}

/* Topo do chat: evita quebra de "Visto por último..." */
body[data-page="chat"] #chatNome,
body[data-page="chat"] #chatStatus{
  display: block !important;
  max-width: 100% !important;
  white-space: nowrap !important;
  overflow: hidden !important;
  text-overflow: ellipsis !important;
}

@media (max-width: 520px){
  body[data-page="chat"] .msg-row .msg-bubble{
    max-width: min(78vw, 320px) !important;
    min-width: 104px !important;
  }

  body[data-page="chat"] .msg-peer-avatar{
    width: 24px;
    height: 24px;
    flex-basis: 24px;
  }

  /* Lista de conversas mais compacta para caber nome + status */
  body[data-page="chat"] .item-conversa{
    padding: 8px 10px !important;
    gap: 8px !important;
  }

  body[data-page="chat"] .item-conversa img{
    width: 30px !important;
    height: 30px !important;
    flex: 0 0 30px !important;
  }

  body[data-page="chat"] .item-conversa .ic-nome{
    font-size: 0.84rem !important;
    line-height: 1.15 !important;
  }

  body[data-page="chat"] .item-conversa .ic-msg{
    font-size: 0.76rem !important;
    line-height: 1.12 !important;
  }

  body[data-page="chat"] .item-conversa .ic-meta{
    gap: 6px !important;
  }

  body[data-page="chat"] .item-conversa .archive-btn{
    width: 24px !important;
    height: 24px !important;
    min-width: 24px !important;
  }

  body[data-page="chat"] .archive-btn i{
    font-size: 16px !important;
  }
}

/* ============================================================
   Chat mobile hardening (footer colado no nav + sem gap)
   ============================================================ */
@media (max-width: 1024px){
  body[data-page="chat"]{
    --chat-shell-h: var(--doke-h, 56px);
    --chat-nav-h: var(--doke-btm-real, 0px);
  }

  body[data-page="chat"] .messenger-layout{
    display: block !important;
    width: 100% !important;
    height: calc(100dvh - var(--chat-shell-h) - var(--chat-nav-h)) !important;
    min-height: calc(100dvh - var(--chat-shell-h) - var(--chat-nav-h)) !important;
    max-height: calc(100dvh - var(--chat-shell-h) - var(--chat-nav-h)) !important;
    margin: 0 !important;
    overflow: hidden !important;
  }

  body[data-page="chat"] .coluna-chat,
  body[data-page="chat"] #box-conversa-real{
    height: 100% !important;
    min-height: 0 !important;
  }

  body[data-page="chat"] #box-conversa-real{
    display: flex !important;
    flex-direction: column !important;
    overflow: hidden !important;
  }

  body[data-page="chat"] .chat-header{
    flex: 0 0 auto !important;
  }

  body[data-page="chat"] #areaMensagens.mensagens-body{
    flex: 1 1 auto !important;
    min-height: 0 !important;
    height: auto !important;
    padding-bottom: 8px !important;
    margin-bottom: 0 !important;
    overflow-y: auto !important;
    overscroll-behavior: contain !important;
    -webkit-overflow-scrolling: touch;
  }

  body[data-page="chat"] #chatFooter.chat-footer{
    position: sticky !important;
    bottom: 0 !important;
    left: 0 !important;
    right: 0 !important;
    z-index: 40 !important;
    margin: 0 !important;
    min-height: 56px !important;
    padding: 8px 10px calc(8px + env(safe-area-inset-bottom)) !important;
    border-top: 1px solid rgba(2, 6, 23, 0.08) !important;
    background: #ffffff !important;
    transform: none !important;
  }

  body[data-page="chat"] #area-input-texto,
  body[data-page="chat"] #uiGravando{
    width: 100% !important;
    margin: 0 !important;
    padding: 0 !important;
  }

  body[data-page="chat"] #uiGravando{
    padding: 0 6px !important;
    background: transparent !important;
  }

  body[data-page="chat"] .input-msg{
    min-width: 0 !important;
    margin: 0 !important;
  }

  /* Teclado aberto no iOS/Android: remove gap entre composer e bottom-nav */
  body[data-page="chat"].chat-kb-open .doke-bottom-nav,
  body[data-page="chat"].chat-kb-open .bottom-nav{
    display: none !important;
  }

  body[data-page="chat"].chat-kb-open .messenger-layout{
    height: calc(100dvh - var(--chat-shell-h)) !important;
    min-height: calc(100dvh - var(--chat-shell-h)) !important;
    max-height: calc(100dvh - var(--chat-shell-h)) !important;
  }

  body[data-page="chat"].chat-kb-open #chatFooter.chat-footer{
    position: fixed !important;
    left: 0 !important;
    right: 0 !important;
    bottom: 0 !important;
    padding-bottom: calc(8px + env(safe-area-inset-bottom)) !important;
  }

  body[data-page="chat"].chat-kb-open #areaMensagens.mensagens-body{
    padding-bottom: calc(72px + env(safe-area-inset-bottom)) !important;
  }
}
