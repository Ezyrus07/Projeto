<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Anunciar Servi√ßo Completo | Doke</title>
    <link rel="stylesheet" href="style.css">
    <script type="module" src="script.js"></script>
    <link href='https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css' rel='stylesheet'>
    <style>
        /* ======================================================
           ESTILOS (PREMIUM & LARGO)
           ====================================================== */
        body { background-color: #f4f6f8; font-family: "Poppins", sans-serif; }

        main {
            padding: 30px 20px;
            margin-top: 80px;
            display: flex;
            justify-content: center;
        }

        @media (min-width: 1024px) {
            main {
                margin-left: 270px; /* Largura da Sidebar */
                margin-top: 0;
                padding: 40px;
                flex-direction: column;
                align-items: center; 
            }
        }

        .content-wrapper { width: 100%; max-width: 1200px; }

        .anuncio-hero-container {
            background: linear-gradient(135deg, var(--cor2, #0095f6) 0%, #1a3c5e 100%);
            padding: 40px; border-radius: 20px; margin-bottom: 30px;
            color: white; box-shadow: 0 10px 30px rgba(42, 95, 144, 0.25);
            text-align: center;
        }
        .anuncio-hero-container h1 { font-size: 2rem; margin-bottom: 10px; font-weight: 700; }

        /* STEPS */
        .progress-wrapper { display: flex; justify-content: center; margin-bottom: 30px; margin-top: 20px;}
        .steps-container { display: flex; gap: 60px; position: relative; } 
        .steps-container::before {
            content: ''; position: absolute; top: 15px; left: 0; width: 100%; height: 2px;
            background: rgba(255,255,255,0.2); z-index: 0;
        }
        .step-circle {
            width: 35px; height: 35px; border-radius: 50%;
            background: rgba(255,255,255,0.2); color: white;
            display: flex; align-items: center; justify-content: center;
            font-weight: 600; position: relative; z-index: 1; transition: 0.3s;
        }
        .step-circle.active { background: white; color: var(--cor2, #0095f6); transform: scale(1.1); }
        .step-label {
            position: absolute; top: 40px; font-size: 0.8rem; color: rgba(255,255,255,0.9);
            width: 100px; text-align: center; margin-left: -32px; font-weight: 500;
        }

        .anuncio-card {
            background: white; border-radius: 20px; padding: 50px;
            box-shadow: 0 5px 25px rgba(0,0,0,0.05); border: 1px solid #eee;
        }

        .form-row { display: grid; grid-template-columns: 1fr 1fr; gap: 25px; margin-bottom: 20px; }
        .form-group { margin-bottom: 20px; position: relative; }
        .form-group label { display: block; font-size: 0.95rem; font-weight: 600; color: #444; margin-bottom: 8px; }
        
        .input-modern, select, textarea {
            width: 100%; padding: 14px 18px; border: 1px solid #ddd;
            border-radius: 10px; background: #f9f9f9; font-size: 1rem;
            color: #333; outline: none; transition: 0.3s;
        }
        .input-modern:focus, select:focus, textarea:focus { border-color: var(--cor0, #2ecc71); background: #fff; }
        textarea { resize: vertical; min-height: 120px; }

        /* UPLOAD ZONE & GALERIA */
        .upload-zone {
            border: 2px dashed #ccc; border-radius: 15px; padding: 30px;
            text-align: center; background: #fafafa; cursor: pointer; transition: 0.2s;
            color: #777; position: relative; display: flex; flex-direction: column; align-items: center; justify-content: center;
        }
        .upload-zone:hover { border-color: var(--cor0, #2ecc71); background: #f0fdfa; color: var(--cor0, #2ecc71); }
        .upload-zone i { font-size: 2.5rem; margin-bottom: 10px; }
        .upload-zone input[type="file"] {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%; opacity: 0; cursor: pointer;
        }
        .file-name-display { font-size: 0.9rem; font-weight: 600; color: var(--cor2, #0095f6); margin-top: 10px; }
        
        /* Preview Galeria */
        .galeria-preview-container { display: flex; gap: 10px; margin-top: 15px; flex-wrap: wrap; }
        .foto-thumb { width: 80px; height: 80px; border-radius: 10px; object-fit: cover; border: 1px solid #ddd; position: relative; }
        .btn-remove-foto { position: absolute; top: -5px; right: -5px; background: red; color: white; border-radius: 50%; width: 20px; height: 20px; font-size: 12px; display: flex; align-items: center; justify-content: center; cursor: pointer; z-index: 2; }

        /* Multi-Select */
        .multi-select-container {
            border: 1px solid #ddd; border-radius: 10px; background: #f9f9f9;
            padding: 8px; position: relative; min-height: 48px; display: flex; flex-wrap: wrap; align-items: center; gap: 8px;
        }
        .tag-item {
            background: var(--cor0, #2ecc71); color: #fff; padding: 6px 14px;
            border-radius: 20px; font-size: 0.9rem; display: flex; align-items: center; gap: 8px;
        }
        .tag-item span { margin-left: 5px; cursor: pointer; font-weight: bold; }
        .cat-dropdown {
            position: absolute; top: 105%; left: 0; width: 100%; max-height: 250px;
            overflow-y: auto; background: #fff; border: 1px solid var(--cor0, #2ecc71);
            border-radius: 10px; z-index: 100; display: none;
            box-shadow: 0 10px 30px rgba(0,0,0,0.15);
        }
        .cat-option { padding: 12px 20px; cursor: pointer; border-bottom: 1px solid #f5f5f5; font-size: 0.95rem; }
        .cat-option:hover { background-color: #f0fdfa; color: var(--cor0, #2ecc71); }

        /* Toggles */
        .toggle-wrapper { display: flex; gap: 20px; flex-wrap: wrap; }
        .radio-card { flex: 1; min-width: 160px; }
        .radio-card input { display: none; }
        .radio-card label {
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            padding: 18px; border: 1px solid #ddd; border-radius: 12px; cursor: pointer;
            background: #fff; font-weight: 600; color: #666; transition: 0.2s;
        }
        .radio-card input:checked + label {
            border-color: var(--cor0, #2ecc71); background: #f0fdfa; color: var(--cor0, #2ecc71);
        }

        .checkbox-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(160px, 1fr)); gap: 15px; }
        .checkbox-card input { display: none; }
        .checkbox-card label {
            display: block; padding: 14px; border: 1px solid #ddd;
            border-radius: 10px; text-align: center; cursor: pointer;
            background: #fff; font-weight: 500;
        }
        .checkbox-card input:checked + label {
            background: var(--cor2, #0095f6); color: white; border-color: var(--cor2, #0095f6);
        }

        .agenda-list { display: flex; flex-direction: column; gap: 10px; max-height: 400px; overflow-y: auto; padding-right: 5px; }
        .agenda-item { 
            background: #fff; border: 1px solid #eee; border-radius: 10px; padding: 15px; 
            display: flex; justify-content: space-between; align-items: center; transition: 0.2s;
        }
        .agenda-item:hover { border-color: var(--cor0); background: #fafffb; }
        .agenda-header { display: flex; align-items: center; gap: 12px; }
        .agenda-header label { font-weight: 600; color: #444; margin: 0; cursor: pointer; }
        .agenda-header input { width: 18px; height: 18px; accent-color: var(--cor0, #2ecc71); cursor: pointer; }
        .agenda-times { display: none; gap: 10px; align-items: center; }
        .agenda-times.show { display: flex; }
        .agenda-times input { padding: 5px; border-radius: 5px; border: 1px solid #ccc; font-size: 0.9rem; }

        .form-nav {
            display: flex; justify-content: space-between; margin-top: 50px;
            padding-top: 30px; border-top: 1px solid #eee;
        }
        .btn-prev {
            background: #fff; color: #666; border: 1px solid #ddd;
            padding: 14px 30px; border-radius: 50px; font-weight: 600; cursor: pointer;
        }
        .btn-next, .btn-submit {
            background: var(--cor0, #2ecc71); color: white; border: none; padding: 14px 40px;
            border-radius: 50px; font-weight: 600; cursor: pointer;
            box-shadow: 0 4px 15px rgba(11, 119, 104, 0.3);
        }
        .btn-submit { display: none; background: #0b7768; }

        .form-step { display: none; animation: fadeIn 0.4s ease-out; }
        .form-step.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        @media (max-width: 768px) {
            .form-row { grid-template-columns: 1fr; }
            .agenda-item { flex-direction: column; align-items: flex-start; gap: 10px; }
            .steps-container { gap: 40px; }
            main { margin-left: 0; }
        }
    </style>
</head>
<body>

    <aside class="sidebar-icones">
        <div id="logo"><a href="index.html"><img src="assets/Imagens/doke-logo.png" alt="Doke" onerror="this.src='https://placehold.co/100x40?text=Doke'"></a></div>
        <div class="item"><a href="index.html"><img src="https://cdn-icons-png.flaticon.com/512/1946/1946436.png" class="icon azul"><span>In√≠cio</span></a></div>
        <div class="item"><a href="explorar.html"><img src="https://cdn-icons-png.flaticon.com/512/622/622669.png" class="icon verde"><span>Explorar</span></a></div>
        <div class="item"><a href="notificacoes.html"><img src="https://cdn-icons-png.flaticon.com/512/1827/1827392.png" class="icon azul"><span>Notifica√ß√µes</span></a></div>
        <div class="item"><a href="chat.html"><img src="https://cdn-icons-png.flaticon.com/512/561/561127.png" class="icon azul"><span>Mensagens</span></a></div>
        <div class="item"><a href="comunidade.html"><img src="https://cdn-icons-png.flaticon.com/512/1144/1144760.png" class="icon verde"><span>Comunidades</span></a></div>
        <div class="item"><a href="meuperfil.html"><img src="https://cdn-icons-png.flaticon.com/512/1077/1077114.png" class="icon verde"><span>Perfil</span></a></div>
        <div class="item"><a href="mais.html"><img src="https://cdn-icons-png.flaticon.com/512/56/56763.png" class="icon azul"><span>Mais</span></a></div>
    </aside>

    <header class="navbar-desktop">
        <div id="logo-desktop"><a href="projeto.html"><img src="assets/Imagens/doke-logo.png" alt="Doke"></a></div>
        <nav class="menu">
            <div class="cep-wrapper">
                <a href="#" class="cep" id="linkCep" onclick="toggleCep(event)">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16"><path d="M8 16s6-5.686 6-10A6 6 0 0 0 2 6c0 4.314 6 10 6 10zm0-7a3 3 0 1 1 0-6 3 3 0 0 1 0 6z"/></svg>
                    <span id="textoCepSpan">Informe seu CEP</span>
                </a>
                <div class="cep-popup" id="boxCep">
                    <p>Digite seu CEP:</p>
                    <div class="cep-input-group"><input type="text" id="inputCep" placeholder="00000-000" maxlength="9"><button onclick="salvarCep()">OK</button></div>
                </div>
            </div>
            <a href="anunciar.html">Anuncie seu servi√ßo</a>
            <a href="comunidade.html">Comunidades <span class="badge-novo">NOVO</span></a>
            <a href="novidades.html">Novidades</a>
        </nav>
        <div class="botoes-direita"><a href="login.html" class="entrar">Entrar</a></div>
    </header>

    <header class="navbar-mobile">
        <div id="logo-mobile"><a href="index.html"><img src="assets/Imagens/doke-logo.png" alt="Doke" onerror="this.src='https://placehold.co/100x40?text=Doke'"></a></div>
    </header>

    <main>
        <div class="content-wrapper">
            <div class="anuncio-hero-container">
                <h1>Criar An√∫ncio</h1>
                <p>Preencha os dados completos para garantir confian√ßa e atrair mais clientes na plataforma Doke.</p>
                <div class="progress-wrapper">
                    <div class="steps-container">
                        <div class="step-circle active" id="p-1">1 <div class="step-label">Detalhes</div></div>
                        <div class="step-circle" id="p-2">2 <div class="step-label">Pol√≠ticas</div></div>
                        <div class="step-circle" id="p-3">3 <div class="step-label">Dados</div></div>
                        <div class="step-circle" id="p-4">4 <div class="step-label">Agenda</div></div>
                    </div>
                </div>
            </div>

            <div class="anuncio-card">
                <form id="formAnuncio" onsubmit="return false;">

                    <div class="form-step active" id="step-1">
                        <h3>Detalhes do Servi√ßo</h3>
                        <div class="form-group">
                            <label>T√≠tulo do An√∫ncio</label>
                            <input type="text" id="titulo" class="input-modern" placeholder="Ex: Manuten√ß√£o El√©trica Residencial" required>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label>Categorias</label>
                                <div class="multi-select-container">
                                    <div class="tags-wrapper" id="tags-wrapper"></div>
                                    <input type="text" id="cat-search" placeholder="Buscar categoria..." oninput="filtrarCategorias()" onfocus="mostrarDropdown()" style="border:none; outline:none; flex:1; background:transparent;">
                                    <div class="cat-dropdown" id="cat-dropdown"></div>
                                </div>
                                <input type="text" id="categorias-validacao" style="opacity:0; position:absolute; height:1px;">
                            </div>
                            <div class="form-group">
                                <label>Tags (Separadas por v√≠rgula)</label>
                                <input type="text" id="tags" class="input-modern" placeholder="Ex: eletricista, reparo, fia√ß√£o">
                            </div>
                        </div>

                        <div class="form-group">
                            <label>Tipo de Atendimento</label>
                            <div class="toggle-wrapper">
                                <div class="radio-card"><input type="radio" name="modo_atend" id="presencial" value="Presencial" checked><label for="presencial">Presencial</label></div>
                                <div class="radio-card"><input type="radio" name="modo_atend" id="online" value="Online"><label for="online">Online</label></div>
                                <div class="radio-card"><input type="radio" name="modo_atend" id="ambos" value="Ambos"><label for="ambos">Ambos</label></div>
                            </div>
                        </div>
                        <div class="form-group">
                            <label>Modelo de Cobran√ßa</label>
                            <div class="toggle-wrapper" style="margin-bottom: 15px;">
                                <div class="radio-card"><input type="radio" name="tipo_preco" id="orcamento" value="Sob Or√ßamento" checked onchange="togglePriceInput()"><label for="orcamento">Sob Or√ßamento</label></div>
                                <div class="radio-card"><input type="radio" name="tipo_preco" id="fixo" value="Pre√ßo Fixo" onchange="togglePriceInput()"><label for="fixo">Pre√ßo Fixo</label></div>
                            </div>
                            <div id="price-input-wrapper" style="display:none;">
                                <input type="text" id="valor" class="input-modern" placeholder="R$ 0,00">
                            </div>
                        </div>
                        <div class="form-group">
                            <label>Descri√ß√£o Detalhada</label>
                            <textarea id="descricao" placeholder="Descreva seu servi√ßo..." required></textarea>
                        </div>

                        <div class="form-group">
                            <label>Fotos do Trabalho (M√°x 5)</label>
                            <div class="upload-zone" onclick="document.getElementById('upload-galeria').click()">
                                <i class='bx bx-images'></i><span>Adicionar fotos da galeria</span>
                                <input type="file" id="upload-galeria" multiple accept="image/*" onchange="processarFotos(this)">
                            </div>
                            <div id="preview-galeria" class="galeria-preview-container"></div>
                        </div>
                    </div>

                    <div class="form-step" id="step-2">
                        <h3>Qualifica√ß√µes</h3>
                        <div class="form-row">
                            <div class="form-group"><label>Experi√™ncia</label><input type="text" id="experiencia" class="input-modern" placeholder="Ex: 5 anos"></div>
                            <div class="form-group"><label>Prazo M√©dio</label><input type="text" id="prazo" class="input-modern" placeholder="Ex: 2 dias"></div>
                        </div>
                        
                        <div class="form-group">
                            <label>Diploma ou Certificado (Opcional)</label>
                            <div class="upload-zone" onclick="document.getElementById('upload-diploma').click()">
                                <i class='bx bx-cloud-upload'></i><span>Clique para enviar PDF ou Imagem</span>
                                <input type="file" id="upload-diploma" onchange="mostrarNomeArquivo(this)">
                                <div class="file-name-display"></div>
                            </div>
                        </div>

                        <div class="form-group"><label>Garantia</label><textarea id="garantia" style="min-height:80px;" placeholder="Detalhes da garantia..."></textarea></div>
                        <div class="form-group"><label>Cancelamento</label><select id="politica" class="input-modern"><option>Flex√≠vel</option><option>Moderada</option><option>R√≠gida</option></select></div>
                        <div class="form-group"><label style="display:flex; gap:10px;"><input type="checkbox" id="emergencia"> Atendo Emerg√™ncias (24h)</label></div>
                    </div>

                    <div class="form-step" id="step-3">
                        <h3>Seus Dados</h3>
                        <div class="form-group">
                            <div class="toggle-wrapper">
                                <div class="radio-card"><input type="radio" name="tipo_pessoa" id="pf" value="PF" checked onchange="toggleCNPJ()"><label for="pf">Pessoa F√≠sica</label></div>
                                <div class="radio-card"><input type="radio" name="tipo_pessoa" id="pj" value="PJ" onchange="toggleCNPJ()"><label for="pj">Empresa</label></div>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label>Foto do Documento (RG/CNH)</label>
                            <div class="upload-zone" onclick="document.getElementById('upload-doc').click()">
                                <i class='bx bx-id-card'></i><span>Clique para enviar foto leg√≠vel</span>
                                <input type="file" id="upload-doc" onchange="mostrarNomeArquivo(this)">
                                <div class="file-name-display"></div>
                            </div>
                        </div>

                        <div class="form-row">
                            <div class="form-group"><label id="lbl-nome">Nome Completo</label><input type="text" id="nome_doc" class="input-modern"></div>
                            <div class="form-group"><label id="lbl-doc">CPF</label><input type="text" id="doc_num" class="input-modern"></div>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label>Telefone</label>
                                <input type="tel" id="telefone" class="input-modern" placeholder="(00) 00000-0000" maxlength="15">
                            </div>
                            <div class="form-group">
                                <label>CEP (Digite para buscar)</label>
                                <input type="text" id="cep" class="input-modern" placeholder="00000-000" maxlength="9" onblur="buscarEndereco(this.value)">
                            </div>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label>Cidade</label>
                                <input type="text" id="cidade" class="input-modern" readonly style="background-color: #f0f0f0;">
                            </div>
                            <div class="form-group">
                                <label>Estado (UF)</label>
                                <input type="text" id="uf" class="input-modern" readonly style="background-color: #f0f0f0;">
                            </div>
                        </div>
                        <div class="form-group">
                            <label>Bairro</label>
                            <input type="text" id="bairro" class="input-modern">
                        </div>

                        <div class="form-group">
                            <label>Pagamentos Aceitos</label>
                            <div class="checkbox-grid">
                                <div class="checkbox-card"><input type="checkbox" id="pg-pix" value="Pix"> <label for="pg-pix">Pix</label></div>
                                <div class="checkbox-card"><input type="checkbox" id="pg-din" value="Dinheiro"> <label for="pg-din">Dinheiro</label></div>
                                <div class="checkbox-card"><input type="checkbox" id="pg-cd" value="D√©bito"> <label for="pg-cd">D√©bito</label></div>
                                <div class="checkbox-card"><input type="checkbox" id="pg-cc" value="Cr√©dito"> <label for="pg-cc">Cr√©dito</label></div>
                            </div>
                        </div>
                    </div>

                    <div class="form-step" id="step-4">
                        <h3>Disponibilidade Semanal</h3>
                        <p style="color:#666; font-size:0.9rem; margin-bottom:20px;">Marque os dias que voc√™ atende e defina o hor√°rio.</p>
                        
                        <div class="agenda-list">
                            <div class="agenda-item">
                                <div class="agenda-header"><input type="checkbox" id="chk-seg" onchange="toggleTime('seg')"><label for="chk-seg">Segunda-feira</label></div>
                                <div class="agenda-times" id="time-seg"><input type="time" id="seg-inicio"> at√© <input type="time" id="seg-fim"></div>
                            </div>
                            <div class="agenda-item">
                                <div class="agenda-header"><input type="checkbox" id="chk-ter" onchange="toggleTime('ter')"><label for="chk-ter">Ter√ßa-feira</label></div>
                                <div class="agenda-times" id="time-ter"><input type="time" id="ter-inicio"> at√© <input type="time" id="ter-fim"></div>
                            </div>
                            <div class="agenda-item">
                                <div class="agenda-header"><input type="checkbox" id="chk-qua" onchange="toggleTime('qua')"><label for="chk-qua">Quarta-feira</label></div>
                                <div class="agenda-times" id="time-qua"><input type="time" id="qua-inicio"> at√© <input type="time" id="qua-fim"></div>
                            </div>
                            <div class="agenda-item">
                                <div class="agenda-header"><input type="checkbox" id="chk-qui" onchange="toggleTime('qui')"><label for="chk-qui">Quinta-feira</label></div>
                                <div class="agenda-times" id="time-qui"><input type="time" id="qui-inicio"> at√© <input type="time" id="qui-fim"></div>
                            </div>
                            <div class="agenda-item">
                                <div class="agenda-header"><input type="checkbox" id="chk-sex" onchange="toggleTime('sex')"><label for="chk-sex">Sexta-feira</label></div>
                                <div class="agenda-times" id="time-sex"><input type="time" id="sex-inicio"> at√© <input type="time" id="sex-fim"></div>
                            </div>
                            <div class="agenda-item">
                                <div class="agenda-header"><input type="checkbox" id="chk-sab" onchange="toggleTime('sab')"><label for="chk-sab">S√°bado</label></div>
                                <div class="agenda-times" id="time-sab"><input type="time" id="sab-inicio"> at√© <input type="time" id="sab-fim"></div>
                            </div>
                            <div class="agenda-item">
                                <div class="agenda-header"><input type="checkbox" id="chk-dom" onchange="toggleTime('dom')"><label for="chk-dom">Domingo</label></div>
                                <div class="agenda-times" id="time-dom"><input type="time" id="dom-inicio"> at√© <input type="time" id="dom-fim"></div>
                            </div>
                        </div>

                        <h3>Configura√ß√£o do Formul√°rio de Triagem</h3>
                        <p style="color:#666; font-size:0.9rem; margin-bottom:20px;">Crie um question√°rio para o cliente responder antes de solicitar o or√ßamento.</p>

                        <div id="lista-perguntas-configuradas" style="margin-bottom: 25px; display: flex; flex-direction: column; gap: 10px;"></div>

                        <div style="background: #ffffff; padding: 25px; border-radius: 15px; border: 2px solid #eef2f6; box-shadow: 0 4px 12px rgba(0,0,0,0.03);">
                            <h4 style="margin-bottom:15px; color: var(--cor2);">+ Nova Quest√£o</h4>
                            
                            <div class="form-group">
                                <label>Tipo de Pergunta</label>
                                <select id="tipo-pergunta-select" class="input-modern" onchange="toggleOpcoesInput()">
                                    <option value="fechada">M√∫ltipla Escolha (Sele√ß√£o)</option>
                                    <option value="aberta">Aberta (Texto livre)</option>
                                </select>
                            </div>

                            <div class="form-group">
                                <label>T√≠tulo da Pergunta</label>
                                <input type="text" id="input-pergunta-txt" class="input-modern" placeholder="Ex: Qual o problema atual?">
                            </div>

                            <div class="form-group" id="container-opcoes-input">
                                <label>Alternativas (separe com v√≠rgula)</label>
                                <input type="text" id="input-opcoes-txt" class="input-modern" placeholder="Ex: Tomada, Disjuntor, Fia√ß√£o">
                                <small style="color: #888;">O cliente escolher√° uma dessas op√ß√µes.</small>
                            </div>

                            <button type="button" onclick="adicionarQuestaoAoForm()" style="background: var(--cor0); color:white; border:none; padding:12px 25px; border-radius:30px; font-weight:600; cursor:pointer; width: 100%;">
                                Adicionar Quest√£o √† Lista
                            </button>
                        </div>

                        <input type="hidden" id="perguntas-formulario-json">
                        <div style="margin-top:20px; padding:15px; background:#eef6fc; border-radius:10px;">
                            <label style="cursor:pointer; display:flex; gap:10px; align-items:center;">
                                <input type="checkbox" id="termos" required style="width:20px; height:20px;"> 
                                Declaro que as informa√ß√µes s√£o verdadeiras.
                            </label>
                        </div>
                    </div>

                    <div class="form-nav">
                        <button type="button" class="btn-prev" id="btn-prev" onclick="changeStep(-1)" style="display:none;">Voltar</button>
                        <button type="button" class="btn-next" id="btn-next" onclick="changeStep(1)">Pr√≥ximo</button>
                        <button type="button" class="btn-submit" id="btn-submit" onclick="publicarAnuncio(event)" style="display:none;">Publicar An√∫ncio</button>
                    </div>

                </form>
            </div>
        </div>
    </main>

    <script>
    // --- L√ìGICA DE PROTE√á√ÉO DE ACESSO (LOGIN E PROFISSIONAL) ---
    document.addEventListener("DOMContentLoaded", function() {
        const perfilLocal = JSON.parse(localStorage.getItem('doke_usuario_perfil'));
        const estaLogado = localStorage.getItem('usuarioLogado') === 'true';

        // 1. Verifica login
        if (!estaLogado) {
            window.location.href = "login.html";
            return;
        }

        // 2. Verifica se √© profissional. Se n√£o for, aplica o desfoque e mostra o card.
        if (!perfilLocal || perfilLocal.isProfissional !== true) {
            // Aplica o desfoque no conte√∫do principal (main)
            const mainContent = document.querySelector('main');
            const sidebar = document.querySelector('.sidebar-icones');
            const navDesktop = document.querySelector('.navbar-desktop');

            if (mainContent) {
                mainContent.style.filter = "blur(12px)";
                mainContent.style.pointerEvents = "none"; 
                mainContent.style.userSelect = "none";    
            }

            // Injeta o CSS do overlay no head
            const style = document.createElement('style');
            style.id = 'style-bloqueio-doke';
            style.innerHTML = `
                .lock-overlay {
                    position: fixed;
                    top: 0;
                    left: 0;
                    width: 100%;
                    height: 100%;
                    background: rgba(255, 255, 255, 0.4);
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    z-index: 99999;
                    font-family: 'Poppins', sans-serif;
                }
                .lock-card {
                    background: white;
                    padding: 40px;
                    border-radius: 24px;
                    box-shadow: 0 20px 40px rgba(0,0,0,0.1);
                    text-align: center;
                    max-width: 420px;
                    width: 90%;
                    animation: dokeFadeUp 0.4s ease-out;
                }
                .lock-icon-circle {
                    width: 70px;
                    height: 70px;
                    background: #e8f5e9;
                    border-radius: 50%;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    margin: 0 auto 20px auto;
                }
                .lock-icon-circle i { font-size: 35px; color: #2ecc71; }
                .lock-card h2 { color: #333; font-size: 1.6rem; margin-bottom: 12px; font-weight: 700; }
                .lock-card p { color: #666; font-size: 0.95rem; line-height: 1.6; margin-bottom: 25px; }
                .lock-btn-go {
                    background: #2ecc71;
                    color: white;
                    padding: 15px 30px;
                    border-radius: 12px;
                    text-decoration: none;
                    font-weight: bold;
                    display: inline-block;
                    transition: 0.3s;
                    margin-bottom: 15px;
                }
                .lock-btn-go:hover { background: #27ae60; transform: translateY(-2px); }
                .lock-btn-back { display: block; color: #888; text-decoration: none; font-size: 0.9rem; transition: 0.2s; }
                .lock-btn-back:hover { color: #333; }
                @keyframes dokeFadeUp {
                    from { opacity: 0; transform: translateY(20px) scale(0.95); }
                    to { opacity: 1; transform: translateY(0) scale(1); }
                }
            `;
            document.head.appendChild(style);

            // Cria o elemento de overlay
            const overlay = document.createElement('div');
            overlay.className = 'lock-overlay';
            overlay.innerHTML = `
                <div class="lock-card">
                    <div class="lock-icon-circle">
                        <i class='bx bxs-lock'></i>
                    </div>
                    <h2>Perfil Profissional Necess√°rio</h2>
                    <p>Para criar an√∫ncios na Doke, voc√™ precisa primeiro validar seus dados no formul√°rio profissional.</p>
                    <div class="lock-actions">
                        <a href="tornar-profissional.html" class="lock-btn-go">Validar meu Perfil</a>
                        <a href="index.html" class="lock-btn-back">Voltar ao In√≠cio</a>
                    </div>
                </div>
            `;
            document.body.appendChild(overlay);
            document.body.style.overflow = "hidden";
        }
    });

    // --- UPLOAD VISUAL HELPER ---
    function mostrarNomeArquivo(input) {
        if(input.files && input.files[0]) {
            const display = input.parentElement.querySelector('.file-name-display');
            display.innerText = "Arquivo selecionado: " + input.files[0].name;
            display.style.display = 'block';
        }
    }

    // --- L√ìGICA DE FOTOS (BASE64) ---
    window.fotosParaEnviar = [];

    function processarFotos(input) {
        if (input.files) {
            const files = Array.from(input.files);
            const container = document.getElementById('preview-galeria');
            if (fotosParaEnviar.length + files.length > 5) {
                alert("M√°ximo de 5 fotos permitidas.");
                return;
            }
            files.forEach(file => {
                const reader = new FileReader();
                reader.onload = function(e) {
                    fotosParaEnviar.push(e.target.result);
                    const div = document.createElement('div');
                    div.style.position = "relative";
                    div.innerHTML = `<img src="${e.target.result}" class="foto-thumb"><div class="btn-remove-foto" onclick="removerFoto(this, '${e.target.result}')">√ó</div>`;
                    container.appendChild(div);
                };
                reader.readAsDataURL(file);
            });
        }
    }

    function removerFoto(elemento, fotoBase64) {
        fotosParaEnviar = fotosParaEnviar.filter(f => f !== fotoBase64);
        elemento.parentElement.remove();
    }

    // --- CATEGORIAS ---
    const todasCategorias = ["Eletricista", "Encanador", "Pintura", "Limpeza", "Frete", "Tecnologia", "Aulas", "Beleza", "Reforma"];
    let categoriasSelecionadas = [];

    function renderCategorias(filtro="") {
        const dropdown = document.getElementById('cat-dropdown');
        dropdown.innerHTML = "";
        const filtradas = todasCategorias.filter(c => c.toLowerCase().includes(filtro.toLowerCase()) && !categoriasSelecionadas.includes(c));
        if (filtradas.length === 0) { dropdown.style.display = 'none'; return; }
        filtradas.forEach(cat => {
            const div = document.createElement('div');
            div.className = 'cat-option'; div.innerText = cat;
            div.onclick = (e) => { 
                e.stopPropagation(); categoriasSelecionadas.push(cat); atualizarTags(); 
                document.getElementById('cat-search').value = ""; dropdown.style.display = 'none'; 
            };
            dropdown.appendChild(div);
        });
        dropdown.style.display = 'block';
    }

    function atualizarTags() {
        document.getElementById('tags-wrapper').innerHTML = categoriasSelecionadas.map(c => `<div class="tag-item">${c} <span onclick="removeCat('${c}')" style="cursor:pointer; margin-left:5px;">&times;</span></div>`).join('');
        document.getElementById('categorias-validacao').value = categoriasSelecionadas.join(',');
    }
    window.removeCat = function(cat) { categoriasSelecionadas = categoriasSelecionadas.filter(c => c !== cat); atualizarTags(); };
    window.filtrarCategorias = function() { renderCategorias(document.getElementById('cat-search').value); };
    window.mostrarDropdown = function() { renderCategorias(); };
    
    document.getElementById('telefone').addEventListener('input', function (e) {
        let x = e.target.value.replace(/\D/g, '').match(/(\d{0,2})(\d{0,5})(\d{0,4})/);
        e.target.value = !x[2] ? x[1] : '(' + x[1] + ') ' + x[2] + (x[3] ? '-' + x[3] : '');
    });
    
    document.getElementById('cep').addEventListener('input', function (e) {
        let valor = e.target.value.replace(/\D/g, ""); 
        if (valor.length > 5) {
            valor = valor.substring(0, 5) + "-" + valor.substring(5, 8);
        }
        e.target.value = valor;
    });

    window.toggleTime = function(dia) { document.getElementById(`time-${dia}`).classList.toggle('show'); }
    window.togglePriceInput = function() {
        const val = document.querySelector('input[name="tipo_preco"]:checked').value;
        document.getElementById('price-input-wrapper').style.display = (val === 'Pre√ßo Fixo') ? 'block' : 'none';
    }
    window.toggleCNPJ = function() {
        const val = document.querySelector('input[name="tipo_pessoa"]:checked').value;
        document.getElementById('lbl-nome').innerText = (val === 'PJ') ? "Raz√£o Social" : "Nome Completo";
        document.getElementById('lbl-doc').innerText = (val === 'PJ') ? "CNPJ" : "CPF";
    }

    let step = 1;
    window.changeStep = function(dir) {
        if(dir === 1) {
            const inputs = document.getElementById(`step-${step}`).querySelectorAll('input[required], select[required], textarea[required]');
            let valid = true;
            inputs.forEach(i => { 
                if(!i.checkValidity()) { i.reportValidity(); valid = false; return; }
            });
            if(!valid) return;
        }

        document.getElementById(`step-${step}`).classList.remove('active');
        document.getElementById(`p-${step}`).classList.remove('active');
        step += dir;
        document.getElementById(`step-${step}`).classList.add('active');
        document.getElementById(`p-${step}`).classList.add('active');
        
        document.getElementById('btn-prev').style.display = step > 1 ? 'block' : 'none';
        if(step === 4) {
            document.getElementById('btn-next').style.display = 'none';
            document.getElementById('btn-submit').style.display = 'block';
        } else {
            document.getElementById('btn-next').style.display = 'block';
            document.getElementById('btn-submit').style.display = 'none';
        }
    }

    async function buscarEndereco(cep) {
        let cepLimpo = cep.replace(/\D/g, '');
        if (cepLimpo.length === 8) {
            document.getElementById('cidade').value = "...";
            document.getElementById('uf').value = "...";
            
            try {
                const response = await fetch(`https://viacep.com.br/ws/${cepLimpo}/json/`);
                const data = await response.json();
                if (!data.erro) {
                    document.getElementById('cidade').value = data.localidade;
                    document.getElementById('uf').value = data.uf;
                    document.getElementById('bairro').value = data.bairro;
                } else {
                    alert("CEP n√£o encontrado.");
                    document.getElementById('cidade').value = "";
                    document.getElementById('uf').value = "";
                }
            } catch (e) {
                console.error("Erro ao buscar CEP:", e);
            }
        }
    }

    let perguntasArray = [];
    window.toggleOpcoesInput = function() {
        const tipo = document.getElementById('tipo-pergunta-select').value;
        const container = document.getElementById('container-opcoes-input');
        container.style.display = (tipo === 'aberta') ? 'none' : 'block';
    }

    window.adicionarQuestaoAoForm = function() {
        const tipo = document.getElementById('tipo-pergunta-select').value;
        const pergunta = document.getElementById('input-pergunta-txt').value;
        const opcoesRaw = document.getElementById('input-opcoes-txt').value;

        if (!pergunta.trim()) { alert("Por favor, digite a pergunta."); return; }

        let novaQuestao = {
            id: Date.now(),
            tipo: tipo,
            pergunta: pergunta,
            opcoes: tipo === 'fechada' ? opcoesRaw.split(',').map(o => o.trim()).filter(o => o !== "") : []
        };

        if (tipo === 'fechada' && novaQuestao.opcoes.length < 2) {
            alert("Para perguntas fechadas, adicione pelo menos 2 alternativas separadas por v√≠rgula.");
            return;
        }

        perguntasArray.push(novaQuestao);
        document.getElementById('perguntas-formulario-json').value = JSON.stringify(perguntasArray);
        renderizarListaPerguntas();
        document.getElementById('input-pergunta-txt').value = "";
        document.getElementById('input-opcoes-txt').value = "";
    }

    function renderizarListaPerguntas() {
        const container = document.getElementById('lista-perguntas-configuradas');
        container.innerHTML = "";
        perguntasArray.forEach((q, index) => {
            const item = document.createElement('div');
            item.style.cssText = "background: white; border: 1px solid #e2e8f0; padding: 15px; border-radius: 10px; display: flex; justify-content: space-between; align-items: center; box-shadow: 0 2px 4px rgba(0,0,0,0.02);";
            const info = q.tipo === 'aberta' ? 'üìù Aberta' : `üîò Fechada (${q.opcoes.length} opc)`;
            item.innerHTML = `
                <div>
                    <span style="font-size: 0.75rem; color: var(--cor2); font-weight: bold; text-transform: uppercase;">${info}</span>
                    <p style="margin: 5px 0 0; font-weight: 500; color: #334155;">${index + 1}. ${q.pergunta}</p>
                </div>
                <button onclick="removerQuestao(${index})" style="background: #fee2e2; color: #ef4444; border: none; width: 32px; height: 32px; border-radius: 50%; cursor: pointer; display: flex; align-items: center; justify-content: center;">
                    <i class='bx bx-trash'></i>
                </button>
            `;
            container.appendChild(item);
        });
    }

    window.removerQuestao = function(index) {
        perguntasArray.splice(index, 1);
        document.getElementById('perguntas-formulario-json').value = JSON.stringify(perguntasArray);
        renderizarListaPerguntas();
    }
    </script>
</body>
</html>