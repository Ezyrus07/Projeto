<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Solicitar Or√ßamento | Doke</title>
    <link rel="stylesheet" href="style.css">
    <link href='https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css' rel='stylesheet'>
    <script type="module" src="script.js"></script>
    <style>/* ==========================================================================
   P√ÅGINA DE OR√áAMENTO
   ========================================================================== */

/* Layout Grid Principal (2 Colunas) */
.layout-orcamento {
    display: grid;
    grid-template-columns: 1.8fr 1fr; /* Esquerda maior, direita menor */
    gap: 30px;
    max-width: 1100px;
    margin: 0 auto;
}

/* --- ESTILO DOS CARDS BRANCOS --- */
.card-branco {
    background: #fff;
    border-radius: 12px;
    padding: 25px;
    box-shadow: 0 2px 10px rgba(0,0,0,0.03);
    margin-bottom: 25px;
    border: 1px solid #f0f0f0;
}

.titulo-sessao {
    color: var(--cor2); /* Azul */
    font-size: 1.1rem;
    margin-bottom: 20px;
    font-weight: 700;
    display: flex;
    align-items: center;
    gap: 10px;
}

/* Inputs e Labels */
.input-group {
    margin-bottom: 20px;
}
.input-group label {
    display: block;
    font-size: 0.9rem;
    color: #555;
    font-weight: 600;
    margin-bottom: 8px;
}
.area-texto {
    min-height: 120px;
    resize: vertical;
    font-family: var(--fonte-padrao);
}

.grid-duplo {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 20px;
}

/* Bot√£o Outline (Buscar CEP) */
.btn-outline {
    background: transparent;
    border: 1px solid var(--cor0);
    color: var(--cor0);
    padding: 0 20px;
    border-radius: 8px;
    font-weight: 600;
    cursor: pointer;
    transition: 0.2s;
}
.btn-outline:hover { background: var(--cor0); color: white; }

/* --- √ÅREA DE UPLOAD --- */
.upload-area {
    border: 2px dashed #ccc;
    border-radius: 12px;
    padding: 30px;
    text-align: center;
    cursor: pointer;
    transition: 0.2s;
    background: #fafafa;
}
.upload-area:hover {
    border-color: var(--cor0);
    background: #f0fdfa;
}
.upload-area i { font-size: 3rem; color: #ccc; margin-bottom: 10px; }
.upload-area p { margin: 0; color: #666; font-weight: 500; }
.upload-area span { font-size: 0.8rem; color: #999; }

.preview-grid {
    display: flex;
    gap: 10px;
    margin-top: 15px;
    flex-wrap: wrap;
}
.preview-grid img {
    width: 60px; height: 60px;
    object-fit: cover;
    border-radius: 8px;
    border: 1px solid #ddd;
}

/* --- CARD RESUMO (STICKY) --- */
.resumo-section {
    position: relative;
}

.card-prestador-resumo {
    background: #fff;
    border: 1px solid #e0e0e0;
    border-radius: 12px;
    padding: 25px;
    position: sticky;
    top: 100px; /* Fica fixo ao rolar a tela */
    box-shadow: 0 4px 20px rgba(0,0,0,0.05);
}

.header-resumo {
    display: flex;
    align-items: center;
    gap: 15px;
    margin-bottom: 15px;
}
.header-resumo img {
    width: 60px; height: 60px;
    border-radius: 50%;
    object-fit: cover;
}
.header-resumo h4 { margin: 0; font-size: 1rem; color: #333; }
.header-resumo span { font-size: 0.85rem; color: #777; }

.stats-resumo {
    display: flex; gap: 15px; font-size: 0.9rem; color: #555; font-weight: 600; margin-bottom: 15px;
}
.stats-resumo i { color: var(--cor0); }

.divisor { border: 0; border-top: 1px solid #eee; margin: 15px 0; }

.lista-vantagens {
    list-style: none; padding: 0; margin-bottom: 25px;
}
.lista-vantagens li {
    font-size: 0.85rem; color: #666; margin-bottom: 12px; display: flex; gap: 8px; line-height: 1.4;
}
.lista-vantagens i { color: var(--cor0); font-size: 1.1rem; flex-shrink: 0; }

/* Bot√£o Principal */
.btn-enviar-orcamento {
    width: 100%;
    padding: 15px;
    background: var(--cor0);
    color: white;
    font-weight: 700;
    font-size: 1rem;
    border: none;
    border-radius: 50px;
    cursor: pointer;
    box-shadow: 0 4px 15px rgba(11, 119, 104, 0.3);
    transition: 0.3s;
}
.btn-enviar-orcamento:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 20px rgba(11, 119, 104, 0.4);
}
.aviso-legal {
    font-size: 0.7rem; color: #999; text-align: center; margin-top: 10px;
}

/* Badge Header Desktop */
.badge-seguranca {
    background: #e0f2f1; color: var(--cor0);
    padding: 6px 15px; border-radius: 30px;
    font-size: 0.85rem; font-weight: 600;
    display: flex; align-items: center; gap: 6px;
}

/* --- RESPONSIVIDADE OR√áAMENTO --- */
@media (max-width: 900px) {
    .layout-orcamento {
        grid-template-columns: 1fr; /* Empilha tudo */
    }
    .card-prestador-resumo {
        position: static; /* Remove o sticky no mobile */
        order: -1; /* Coloca o resumo acima do formul√°rio no mobile */
        margin-bottom: 25px;
    }
    .grid-duplo { grid-template-columns: 1fr; }
}</style>
</head>
<body>

    <header class="navbar-mobile">
        <div id="logo-mobile">
            <a href="index.html">
                <img src="assets/Imagens/doke-logo.png" alt="Doke" onerror="this.src='https://placehold.co/100x40?text=Doke'">
            </a>           
        </div>
        <div class="mobile-controls" style="display: flex; align-items: center; gap: 15px;">
            <button id="btn-menu-mobile" onclick="abrirMenuMobile()">
                <i class='bx bx-menu' style="font-size: 30px; color: var(--cor2);"></i>
            </button>
        </div>
    </header>

    <div id="overlay-menu" onclick="fecharMenuMobile()"></div>
    
    <aside class="sidebar-icones">
        <div id="logo">
            <a href="index.html">
                <img src="assets/Imagens/doke-logo.png" alt="Logotipo da plataforma Doke">
            </a>
        </div>

        <div class="item">
            <a href="index.html"><img src="https://cdn-icons-png.flaticon.com/512/1946/1946436.png" class="icon azul" alt="In√≠cio">
            <span>In√≠cio</span></a>
        </div>
        <div class="item">
            <a href="explorar.html"><img src="https://cdn-icons-png.flaticon.com/512/622/622669.png" class="icon verde" alt="Explorar">
            <span>Explorar</span></a>
        </div>
        <div class="item">
            <a href="notificacoes.html"><img src="https://cdn-icons-png.flaticon.com/512/1827/1827392.png" class="icon azul" alt="Notifica√ß√µes">
            <span>Notifica√ß√µes</span></a>
        </div>
        <div class="item">
            <img src="https://cdn-icons-png.flaticon.com/512/561/561127.png" class="icon azul" alt="Mensagens">
            <a href="chat.html"><span>Mensagens</span></a>
        </div>
        <div class="item">
            <a href="comunidade.html"><img src="https://cdn-icons-png.flaticon.com/512/1144/1144760.png" class="icon verde" alt="Comunidades">
            <span>Comunidades</span></a>
        </div>
        <div class="item">
            <img src="https://cdn-icons-png.flaticon.com/512/1077/1077114.png" class="icon verde" alt="Comunidades">
            <a href="meuperfil.html"><span>Perfil</span></a>
        </div>
        <div class="item">
            <img src="https://cdn-icons-png.flaticon.com/512/56/56763.png" class="icon azul" alt="Mais">
            <a href="mais.html"><span>Mais</span></a>
        </div>
    </aside>


    <header class="navbar-desktop">
        <div id="logo-desktop">
            <a href="projeto.html">
                <img src="assets/Imagens/doke-logo.png" alt="Doke">
            </a>
        </div>
        <nav class="menu">
            <div class="cep-wrapper">
                <a href="#" class="cep" id="linkCep" onclick="toggleCep(event)">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                        <path d="M8 16s6-5.686 6-10A6 6 0 0 0 2 6c0 4.314 6 10 6 10zm0-7a3 3 0 1 1 0-6 3 3 0 0 1 0 6z"/>
                    </svg>
                    <span id="textoCepSpan">Informe seu CEP</span>
                </a>

                <div class="cep-popup" id="boxCep">
                    <p>Digite seu CEP:</p>
                    <div class="cep-input-group">
                        <input type="text" id="inputCep" placeholder="00000-000" maxlength="9">
                        <button onclick="salvarCep()">OK</button>
                    </div>
                </div>
            </div>
            
            <a href="anunciar.html">Anuncie seu servi√ßo</a>
            <a href="comunidade.html">Comunidades <span class="badge-novo">NOVO</span></a>
            <a href="novidades.html">Novidades</a>
        </nav>

        <div class="botoes-direita">
            <a href="login.html" class="entrar">Entrar</a>
            <a href="login.html">
            </a>
        </div>
    </header>

    <main class="main-orcamento">
        
        <div class="layout-orcamento">
            
            <section class="form-section">
                
                <div class="card-branco">
                    <h3 class="titulo-sessao">1. Detalhes do Pedido</h3>
                    
                    <div class="input-group">
                        <label>O que voc√™ precisa?</label>
                        <input type="text" class="input-premium" id="titulo-pedido" placeholder="Ex: Instala√ß√£o de 3 tomadas e 1 chuveiro">
                    </div>

                    <div id="container-perguntas-extras" style="display:none; margin-top: 20px; padding-top: 20px; border-top: 1px solid #eee;">
                        <h4 style="color: var(--cor2); margin-bottom: 15px;">Perguntas do Profissional</h4>
                        <div id="lista-perguntas-dinamicas"></div>
                    </div>

                    <div class="input-group" style="margin-top: 20px;">
                        <label>Descri√ß√£o detalhada</label>
                        <textarea class="input-premium area-texto" id="descricao-pedido" placeholder="Descreva o problema, o local, se precisa comprar material, etc..."></textarea>
                    </div>

                    <div class="grid-duplo">
                        <div class="input-group">
                            <label>Para quando?</label>
                            <select class="input-premium" id="para-quando">
                                <option>O quanto antes</option>
                                <option>Para esta semana</option>
                                <option>Para o pr√≥ximo m√™s</option>
                                <option>Data espec√≠fica</option>
                            </select>
                        </div>
                        <div class="input-group">
                            <label>Turno de prefer√™ncia</label>
                            <select class="input-premium" id="turno">
                                <option>Manh√£ (08h - 12h)</option>
                                <option>Tarde (13h - 18h)</option>
                                <option>Noite (ap√≥s 18h)</option>
                            </select>
                        </div>
                    </div>
                </div>

                <div class="card-branco" id="card-localizacao">
                    <h3 class="titulo-sessao">2. Localiza√ß√£o</h3>
                    <div class="input-group">
                        <label>CEP do servi√ßo</label>
                        <div style="display:flex; gap:10px;">
                            <input type="text" id="cepOrcamento" class="input-premium" placeholder="00000-000">
                            <button class="btn-outline" onclick="buscarEndereco()">Buscar</button>
                        </div>
                    </div>
                    <div class="input-group">
                        <label>Endere√ßo completo</label>
                        <input type="text" id="endereco-completo" class="input-premium" placeholder="Rua, N√∫mero, Complemento">
                    </div>
                </div>

                <div class="card-branco">
                    <h3 class="titulo-sessao">3. Fotos ou V√≠deos (Opcional)</h3>
                    <div class="upload-area" onclick="document.getElementById('fileInput').click()">
                        <i class='bx bx-cloud-upload'></i>
                        <p>Clique para adicionar fotos do local ou do problema</p>
                        <span>(M√°x. 5 fotos)</span>
                        <input type="file" id="fileInput" multiple hidden onchange="previewFiles()">
                    </div>
                    <div id="previewArea" class="preview-grid"></div>
                </div>

            </section>

<aside class="resumo-section">
    <div class="card-prestador-resumo">
        <div class="header-resumo">
            <img src="https://placehold.co/150" alt="Prestador" id="imgPrestadorResumo">
            <div>
                <h4 id="nomePrestadorResumo">Carregando...</h4>
                <span id="userPrestadorResumo">@...</span>
            </div>
        </div>
        
        <div class="stats-resumo">
            <div><i class='bx bxs-star'></i> <span id="notaPrestadorResumo">--</span></div>
            <div><i class='bx bx-briefcase'></i> <span id="jobsPrestadorResumo">0</span> Jobs</div>
        </div>

        <hr class="divisor">

        <ul class="lista-vantagens">
            <li><i class='bx bx-check-shield'></i> <strong>Garantia Doke:</strong> S√≥ liberamos o pagamento quando voc√™ aprovar o servi√ßo.</li>
            <li><i class='bx bx-time-five'></i> Resposta m√©dia em 20 min.</li>
        </ul>

        <button class="btn-enviar-orcamento" id="btnEnviarOrcamento">
            Enviar Solicita√ß√£o
        </button>
        <p class="aviso-legal">Ao enviar, voc√™ concorda com nossos termos.</p>
    </div>
</aside>

        </div>
    </main>

        <nav class="bottom-nav">
        <a href="index.html" class="item active">
            <img src="https://cdn-icons-png.flaticon.com/512/1946/1946436.png" class="icon azul" alt="In√≠cio">
            <span>In√≠cio</span>
        </a>
        <a href="explorar.html" class="item">
            <img src="https://cdn-icons-png.flaticon.com/512/622/622669.png" class="icon verde" alt="Explorar">
            <span>Explorar</span>
        </a>
        <a href="anunciar.html" class="item">
            <img src="assets/Imagens/icone-anunciar.png" class="icon azul" alt="Anunciar" onerror="this.src='https://cdn-icons-png.flaticon.com/512/1077/1077114.png'">
            <span>Anunciar</span>
        </a>
        <a href="notificacoes.html" class="item">
            <img src="https://cdn-icons-png.flaticon.com/512/1827/1827392.png" class="icon azul" alt="Notifica√ß√µes">
            <span>Notifica√ß√µes</span>
        </a>
        <a href="perfil.html" class="item">
            <img src="https://cdn-icons-png.flaticon.com/512/1077/1077114.png" class="icon verde" alt="Perfil">
            <span>Perfil</span>
        </a>
    </nav>

<script type="module">
    import { getFirestore, doc, getDoc, addDoc, collection } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";
    import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js";

    // Inicializa vari√°veis e servi√ßos
    const db = window.db || getFirestore();
    const auth = window.auth || getAuth();

    let dadosPrestador = null;
    let dadosAnuncio = null;

    window.addEventListener('load', async function() {
        console.log("üöÄ Script de Or√ßamento Iniciado...");

        const urlParams = new URLSearchParams(window.location.search);
        const anuncioId = urlParams.get('aid') || urlParams.get('id'); 
        const prestadorUid = urlParams.get('uid'); 

        // 1. Carrega Prestador
        if(prestadorUid) {
            try {
                const docUserRef = doc(db, "usuarios", prestadorUid);
                const docUserSnap = await getDoc(docUserRef);
                if (docUserSnap.exists()) {
                    dadosPrestador = docUserSnap.data();
                    dadosPrestador.uid = prestadorUid; 
                    atualizarCardResumo(dadosPrestador);
                }
            } catch (e) { console.error("Erro user:", e); }
        }

        // 2. Carrega An√∫ncio e Aplica Regras
        if (anuncioId) {
            try {
                const docAnuncioRef = doc(db, "anuncios", anuncioId);
                const docAnuncioSnap = await getDoc(docAnuncioRef);
                
                if (docAnuncioSnap.exists()) {
                    dadosAnuncio = docAnuncioSnap.data();
                    
                    // Preenche t√≠tulo
                    if(dadosAnuncio.titulo) document.getElementById('titulo-pedido').value = "Or√ßamento: " + dadosAnuncio.titulo;
                    
                    // Chama a fun√ß√£o que ESCONDE o endere√ßo se for Online
                    aplicarConfiguracoesDoAnuncio(dadosAnuncio);
                }
            } catch (e) { console.error("Erro anuncio:", e); }
        } else {
            console.warn("‚ö†Ô∏è Nenhum ID de an√∫ncio (aid) na URL.");
        }

        // 3. Bloqueia se for o dono
        onAuthStateChanged(auth, (user) => {
            if (user && prestadorUid && user.uid === prestadorUid) {
                bloquearBotaoProprioAnuncio();
            }
        });
    });

    // --- FUN√á√ÉO QUE ESCONDE A CAIXA DE LOCALIZA√á√ÉO ---
    function aplicarConfiguracoesDoAnuncio(anuncio) {
        const cardLoc = document.getElementById('card-localizacao');
        const inputCep = document.getElementById('cepOrcamento');
        const inputEnd = document.getElementById('endereco-completo');

        // Formata√ß√£o robusta para detectar "online"
        const modo = String(anuncio.modo_atend || "").toLowerCase().trim();
        
        if (modo === 'online' || modo.includes('remoto')) {
            if(cardLoc) cardLoc.style.display = 'none';
            if(inputCep) { inputCep.removeAttribute('required'); inputCep.value = ""; }
            if(inputEnd) { inputEnd.removeAttribute('required'); inputEnd.value = ""; }
        } else {
            if(cardLoc) cardLoc.style.display = 'block';
        }

        carregarPerguntasExtras(anuncio);
    }

    // --- L√ìGICA DE ENVIO DO PEDIDO ---
    const btnEnviar = document.getElementById('btnEnviarOrcamento');
    if(btnEnviar) {
        btnEnviar.addEventListener('click', async (e) => {
            e.preventDefault();
            const user = auth.currentUser;
            
            // 1. Valida√ß√µes B√°sicas
            if (!user) { alert("Fa√ßa login para continuar."); window.location.href = "login.html"; return; }
            
            // --- CORRE√á√ÉO: PEGA O UID DA URL NOVAMENTE AQUI DENTRO ---
            const uidDestino = new URLSearchParams(window.location.search).get('uid');
            
            const titulo = document.getElementById('titulo-pedido').value;
            const descricao = document.getElementById('descricao-pedido').value;
            if (!titulo || !descricao) { alert("Preencha o t√≠tulo e a descri√ß√£o do pedido."); return; }

            // 2. Valida√ß√£o de Endere√ßo (S√≥ se estiver vis√≠vel)
            const cardLoc = document.getElementById('card-localizacao');
            let localizacaoData = { tipo: "Online" };
            
            if (cardLoc && cardLoc.style.display !== 'none') {
                const cep = document.getElementById('cepOrcamento').value;
                const end = document.getElementById('endereco-completo').value;
                if(!cep || !end) { alert("Informe o endere√ßo para servi√ßos presenciais."); return; }
                localizacaoData = { tipo: "Presencial", cep: cep, endereco: end };
            }

            // 3. Coleta Respostas Extras
            let respostasExtras = [];
            document.querySelectorAll('.pergunta-extra').forEach(inp => {
                if(inp.value) respostasExtras.push({ pergunta: inp.getAttribute('data-pergunta'), resposta: inp.value });
            });

            // 4. Efeito de Carregamento
            btnEnviar.innerHTML = "<i class='bx bx-loader-alt bx-spin'></i> Enviando...";
            btnEnviar.disabled = true;

            try {
                const perfilCliente = JSON.parse(localStorage.getItem('doke_usuario_perfil')) || {};
                const anuncioIdRef = new URLSearchParams(window.location.search).get('aid');

                // 5. Salva no Firebase
                const docRef = await addDoc(collection(db, "pedidos"), {
                    deUid: user.uid,
                    paraUid: uidDestino, 
                    paraNome: dadosPrestador ? dadosPrestador.nome : "Profissional",
                    // ADICIONADO: Salva o user e a foto do prestador
                    paraUser: dadosPrestador ? (dadosPrestador.user || "@" + dadosPrestador.nome.split(' ')[0]) : "@profissional",
                    paraFoto: dadosPrestador ? dadosPrestador.foto : "https://placehold.co/150",
                    
                    clienteNome: perfilCliente.nome || "Cliente",
                    clienteFoto: perfilCliente.foto || "https://cdn-icons-png.flaticon.com/512/847/847969.png",
                    servicoReferencia: titulo,
                    mensagemInicial: descricao,
                    paraQuando: document.getElementById('para-quando').value,
                    turno: document.getElementById('turno').value,
                    localizacao: localizacaoData,
                    formularioRespostas: respostasExtras,
                    origemAnuncioId: anuncioIdRef || null,
                    status: "pendente",
                    dataPedido: new Date().toISOString(),
                    visualizado: false
                });

                window.location.href = `chat.html?chatId=${docRef.id}`;

            } catch (error) {
                console.error("Erro envio:", error);
                alert("Erro ao enviar: " + error.message);
                btnEnviar.innerHTML = "Enviar Solicita√ß√£o";
                btnEnviar.disabled = false;
            }
        });
    }

    // --- FUN√á√ïES AUXILIARES VISUAIS ---
    function atualizarCardResumo(dados) {
        if(document.getElementById('nomePrestadorResumo'))
            document.getElementById('nomePrestadorResumo').innerHTML = `${dados.nome} <i class='bx bxs-badge-check' style="color:#0095f6;"></i>`;
        if(document.getElementById('userPrestadorResumo'))
            document.getElementById('userPrestadorResumo').innerText = dados.user || "@profissional";
        if(document.getElementById('imgPrestadorResumo'))
            document.getElementById('imgPrestadorResumo').src = dados.foto || "https://placehold.co/150";
        if(dados.stats) {
            if(document.getElementById('notaPrestadorResumo')) 
                document.getElementById('notaPrestadorResumo').innerText = dados.stats.media || "Novo";
            if(document.getElementById('jobsPrestadorResumo'))
                document.getElementById('jobsPrestadorResumo').innerText = dados.stats.jobs || 0;
        }
    }

    function bloquearBotaoProprioAnuncio() {
        const btn = document.getElementById('btnEnviarOrcamento');
        if(btn) {
            btn.disabled = true;
            btn.innerHTML = "<i class='bx bx-block'></i> Voc√™ √© o dono";
            btn.style.background = "#ccc";
            btn.style.cursor = "not-allowed";
        }
    }

    function carregarPerguntasExtras(anuncio) {
        let perguntas = [];
        if (anuncio.perguntasFormularioJson) {
            try {
                perguntas = (typeof anuncio.perguntasFormularioJson === 'string') 
                    ? JSON.parse(anuncio.perguntasFormularioJson) 
                    : anuncio.perguntasFormularioJson;
            } catch(e) {}
        }
        const container = document.getElementById('container-perguntas-extras');
        const lista = document.getElementById('lista-perguntas-dinamicas');
        if (perguntas.length > 0 && container && lista) {
            container.style.display = 'block';
            lista.innerHTML = "";
            perguntas.forEach((p, i) => {
                const div = document.createElement('div');
                div.className = 'input-group';
                let inputHtml = p.tipo === 'fechada' 
                    ? `<select class="input-premium pergunta-extra" data-pergunta="${p.pergunta}"><option value="" disabled selected>Selecione...</option>${p.opcoes.map(o=>`<option>${o}</option>`).join('')}</select>`
                    : `<input type="text" class="input-premium pergunta-extra" data-pergunta="${p.pergunta}">`;
                div.innerHTML = `<label style="color:var(--cor2);">${i+1}. ${p.pergunta}</label>${inputHtml}`;
                lista.appendChild(div);
            });
        }
    }

    // Helpers Globais
    window.buscarEndereco = function() {
        const cepEl = document.getElementById('cepOrcamento');
        if(!cepEl) return;
        const cep = cepEl.value.replace(/\D/g, '');
        if(cep.length === 8) {
            fetch(`https://viacep.com.br/ws/${cep}/json/`).then(r=>r.json()).then(d=>{
                if(!d.erro) document.getElementById('endereco-completo').value = `${d.logradouro}, ${d.bairro} - ${d.localidade}`;
            });
        }
    }
    
    window.previewFiles = function() {
        const preview = document.getElementById('previewArea');
        const files = document.getElementById('fileInput').files;
        preview.innerHTML = "";
        if (files) {
            [].forEach.call(files, function(file) {
                if (/\.(jpe?g|png|gif)$/i.test(file.name)) {
                    const img = document.createElement('img');
                    img.src = URL.createObjectURL(file);
                    preview.appendChild(img);
                }
            });
        }
    }
</script>
</body>
</html>